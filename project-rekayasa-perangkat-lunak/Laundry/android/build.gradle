// Top-level build file where you can add configuration options common to all sub-projects/modules.

buildscript {
  repositories {
    google()
    mavenCentral()
  }
  dependencies {
    classpath('com.android.tools.build:gradle')
    classpath('com.facebook.react:react-native-gradle-plugin')
    classpath('org.jetbrains.kotlin:kotlin-gradle-plugin')
  }
}

def reactNativeAndroidDir = new File(
  providers.exec {
    workingDir(rootDir)
    commandLine("node", "--print", "require.resolve('react-native/package.json')")
  }.standardOutput.asText.get().trim(),
  "../android"
)

allprojects {
  repositories {
    // ─── repos inti ─────────────────────────────────────────────
    maven { url(reactNativeAndroidDir) }      // React Native AAR dari node_modules
    google()
    mavenCentral()
    maven { url 'https://www.jitpack.io' }

    // ─── redirect JCenter HTTP/HTTPS → Maven Central ───────────
        all { repo ->
      def u = repo.url.toString()
      if (u.startsWith('http://jcenter.bintray.com') ||
          u.startsWith('https://jcenter.bintray.com')) {

        remove repo
        add mavenCentral()
      }
    }
  }
}

subprojects { sub ->
  // redirect buildscript.repositories
  sub.buildscript.repositories.all { repo ->
    def url = repo.url.toString()
    if (url.startsWith('http://')) {
      // 1) coba alihkan ke https
      def httpsUrl = url.replace('http://', 'https://')
      repo.setUrl(uri(httpsUrl))
      // 2) jika repo tsb memang tak punya https, boleh aktifkan baris di bawah
      //    (tapi kurangi keamanan, jadi pakai hanya bila perlu)
      // repo.allowInsecureProtocol = true
    }
  }
}


apply plugin: "expo-root-project"
apply plugin: "com.facebook.react.rootproject"
